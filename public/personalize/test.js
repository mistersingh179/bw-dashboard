// show a widget when scrolled down

const personalizedResults = [
  {
    options: {
      howOften: "Never",
      whichSmartDevice: "Smartphone",
      primaryConcern: "Driving Safety",
    },
    text: `<strong>Unlocking the Secrets of Sobriety Through Smartphone Insights</strong>

<p>Modern technology has once again blurred the lines between innovation and everyday life. Picture this: your smartphone silently becoming a guardian, watching over your well-being in the most unexpected way. Recent research, led by Professor Brian Suffoletto from Stanford Medicine and the University of Toronto, delves into a groundbreaking study that could reshape how we approach alcohol-related concerns, especially for those who, like you, prioritize driving safety and abstain from alcoholic beverages.</p>
<strong>The Unlikely Detectives: Your Smartphone and Sobriety</strong>

<p>The study navigates uncharted territories by tapping into the very device you interact with daily. In a bid to address the crucial issue of intoxicated driving, researchers explore the potential of smartphones in gauging a person's level of intoxication through changes in vocal patterns. The approach involves participants, much like yourself, who abstain from alcohol, reading tongue twisters aloud while their smartphone records their speech. The results, as you'll find intriguing, showcase a staggering 98-percent accuracy in predicting intoxication, thanks to cutting-edge advancements in signal processing, acoustic analysis, and machine learning.</p>
<strong>A Personalized Approach to Preventing Mishaps</strong>

<p>The research isn't merely a scientific endeavor; it's a call to action for developing "just-in-time interventions" to prevent injuries and fatalities resulting from alcohol-related accidents. Recognizing the potential annoyance or counterproductive nature of frequent check-ins, the researchers propose a passive surveillance tool. Imagine, in your case, your smartphone seamlessly monitoring changes in your daily routines, silently surveilling for signs that could indicate a drinking episode, ensuring timely help when needed.</p>
<strong>The Future of Sobriety Surveillance</strong>

<p>Looking ahead, Professor Suffoletto envisions a comprehensive surveillance system that goes beyond voice analysis. Integrating multiple sensors, such as those detecting changes in gait, voice, and texting patterns, could significantly enhance the overall performance of the intervention tool. The rationale is clear: different situations demand different indicators, ensuring a more robust and reliable system, especially considering instances where individuals may not be speaking for hours but could be engaging in other activities.</p>
<strong>Diverse Voices, Inclusive Solutions</strong>

<p>Recognizing the importance of diversity in research, the team emphasizes the need for more extensive studies involving participants from diverse ethnic backgrounds. This inclusivity aims to verify the reliability of voice patterns as an indicator of intoxication across various demographic groups, ensuring that any future intervention system is universally effective.</p>
<strong>A Digital Call to Action</strong>

<p>Dr. Suffoletto's call to action extends beyond the confines of the research lab. He urges health authorities to establish repositories for digital biomarkers, viewing them as key to developing a user-friendly intervention system capable of preventing injuries and saving lives. The study, a testament to the intersection of technology and well-being, is published in the Journal of Studies on Alcohol and Drugs, pointing towards a future where your smartphone becomes an ally in safeguarding your commitment to sobriety and driving safety.</p>`,
  },
  {
    options: {
      howOften: "Occasionally",
      whichSmartDevice: "Smartphone",
      primaryConcern: "Driving Safety",
    },
    text: `<strong>Unlocking Your Smartphone's Hidden Superpower</strong>

<p>Ever wonder if your smartphone could do more than just keep you connected and entertained? A groundbreaking study by Stanford Medicine and the University of Toronto might just have the answer. If you, like many, occasionally enjoy a drink and are concerned about its impact on your safety, especially when it comes to driving, this research could be a game-changer.</p>
<strong>The Power of Your Voice, Unleashed</strong>

<p>The study delves into an innovative approach, utilizing the very device you likely have in your pocket every day. Imagine this: your smartphone becoming a silent guardian, actively monitoring your well-being without any effort on your part. Researchers found that by analyzing changes in voice patterns, they could accurately predict a person's level of intoxication, with a staggering 98-percent accuracy rate.</p>
<strong>How It Works</strong>

<p>Participants in the study, much like yourself, consumed alcohol in carefully measured amounts. What sets this study apart is the simplicity of the process: reading tongue twisters aloud. Meanwhile, the smartphone, resting on a table, quietly recorded their speech. The researchers then used advanced digital software to analyze various attributes such as frequency and pitch, correlating these changes with breathalyzer readings. The result? A powerful tool that could revolutionize how we approach alcohol-related safety concerns.</p>
<strong>Why This Matters to You</strong>

<p>Given your primary concern about driving safety, imagine a future where your smartphone, through passive data sampling, could alert you or others when it senses a potential issue. No need for constant check-ins, which can be annoying or even counterproductive. Dr. Brian Suffoletto, the lead researcher, envisions a world where technology acts as a silent guardian, intervening just when needed.</p>
<strong>The Future of Safety</strong>

<p>The researchers aren't stopping here. Dr. Suffoletto envisions a comprehensive surveillance system, combining various sensors to detect changes in not only voice but also gait and texting patterns. This multi-faceted approach aims for maximum accuracy, ensuring that no potential signs of intoxication go unnoticed.</p>
<strong>Your Role in the Future</strong>

<p>This isn't just a scientific breakthrough; it's a call to action. The researchers urge for more extensive studies involving diverse participants, including those from different ethnic backgrounds. They propose collaboration with companies collecting speech data via smart devices, emphasizing the need to establish repositories for digital biomarkers.</p>
<strong>The Countdown to Prevention</strong>

<p>The ultimate goal? A user-friendly intervention system that could save lives by preventing injuries. Dr. Suffoletto emphasizes the importance of timing, suggesting that interventions are most effective when delivered at the optimal moment. This could mean a timely reminder of your consumption limits just as you initiate drinking, ensuring you stay within safe boundaries.</p>
<strong>Your Smartphone: Your Silent Guardian</strong>

<p>So, the next time you reach for your smartphone, remember—it might just be your key to a safer, more secure future, where technology actively works to protect you and those around you. Your safety is in your hands, or rather, in your voice.</p>
<strong>Source:</strong> Journal of Studies on Alcohol and Drugs, with contributions from South West News Service writer Stephen Beech.`,
  },
  {
    options: {
      howOften: "Regularly",
      whichSmartDevice: "Smartphone",
      primaryConcern: "Driving Safety",
    },
    text: `<strong>Unlocking the Power of Smartphones: Predicting Intoxication Levels with Surprising Accuracy</strong>

<p>Ever wondered if your smartphone could do more than just send messages and take photos? A groundbreaking study by Stanford Medicine and the University of Toronto might just have the answer, especially if you're someone who regularly enjoys alcoholic beverages and has concerns about driving safety.</p>
<p>Scientists delved into the realm of vocal changes induced by alcohol consumption, utilizing the ubiquitous smartphone to measure intoxication levels. If you're a smartphone user, this research could hit close to home, as it explores the potential of our daily devices in addressing a significant concern: the safety of driving under the influence.</p>
<p>The study involved participants like you, who consume alcohol regularly. Imagine this scenario: individuals adjusting their alcohol intake based on their weight, engaging in tongue twisters before and after drinking, all while their smartphones silently observed. The research team discovered that smartphones, with their built-in sensors, could accurately predict intoxication levels by analyzing changes in speech patterns, achieving an astonishing 98-percent accuracy rate.</p>
<p>Now, if driving safety is a top concern for you, this study could be a game-changer. The researchers envision "just-in-time interventions" that could prevent accidents and mishaps related to alcohol consumption. But here's the twist – they're advocating for a tool that doesn't intrusively check in on you. Imagine having a passive system on your smartphone that discreetly monitors your behavior, alerting you or someone close when it detects signs of intoxication.</p>
<p>Dr. Brian Suffoletto, the lead researcher, emphasizes the need for tools that go beyond just speech analysis. For someone like you, who uses a smartphone regularly, the potential integration of various sensors like gait, voice, and texting patterns could be revolutionary. This means a more comprehensive and reliable system that considers different aspects of your daily routine, providing a nuanced understanding of your well-being.</p>
<p>But the researchers aren't stopping there. They acknowledge the importance of diversity in their studies and suggest collaborations with companies that collect speech data via smart devices. For you, this means a future intervention system that understands and caters to a wide range of individuals, considering diverse ethnic backgrounds and speech patterns.</p>
<p>As you navigate your daily routines, the researchers are calling for action to establish repositories for digital biomarkers, making interventions not just effective but user-friendly. For someone who, like you, values driving safety, this could mean a future where technology actively contributes to preventing injuries and saving lives, all while seamlessly fitting into your daily life.</p>
<p>The study, published in the Journal of Studies on Alcohol and Drugs, could be a stepping stone toward a safer and more connected future. It's not just about technology; it's about personalizing safety measures for individuals like you who prioritize responsible alcohol consumption and, above all, driving safety.</p>
<p>This isn't just science; it's a call to action, urging health authorities to pave the way for a future where your smartphone becomes a silent guardian, ensuring your safety without being intrusive.</p>
<p>South West News Service writer Stephen Beech contributed to this report.</p>`,
  },
];

let startTime = new Date().getTime();
let passedTimeBank = 0;

const totalTimeSpent = () => new Date().getTime() - startTime + passedTimeBank;

window.tt = totalTimeSpent;

document.addEventListener("visibilitychange", (event) => {
  if (document.visibilityState === "hidden") {
    passedTimeBank += new Date().getTime() - startTime;
  } else if (document.visibilityState === "visible") {
    startTime = new Date().getTime();
  }
});

const template = document.createElement("template");
template.innerHTML = `<div id="bw-container" class="hide">
      <div><strong>Personalize This Article</strong></div>
      How often do you consume alcoholic beverages? 
      <select name="howOften">
        <option value="Never">Never</option>
        <option value="Occasionally">Occasionally</option>
        <option value="Regularly">Regularly</option>
      </select>
      Which smart devices do you use on a daily basis? 
      <select name="whichSmartDevice">
        <option value="Smartphone">Smartphone</option>
        <option value="Smart Speaker">Smart Speaker</option>
        <option value="Both">Both</option>
        <option value="None">None</option>
      </select>
      What is your primary concern regarding alcohol consumption?
      <select name="primaryConcern">
        <option value="Driving Safety">Driving Safety</option>
        <option value="Overall Health">Overall Health</option>
        <option value="Social Interactions">Social Interactions</option>
      </select>
      <div class="btn-row">
        <input type="button" value="Close" class="closePersonalize"></input>
        <input type="button" value="Personalize" class="personalize"></input>
      </div>
    </div>`.trim();
const item = template.content.firstChild;

const widgetTemplate = document.createElement("template");
widgetTemplate.innerHTML = `<div id="bw-widget">
<div class="widgedHeading">
  <strong>Personalized Answer:</strong>
  <input type="button" class="showOptions" value="Show Options"></input>
</div>
<div class="personalizedContent">
</div>
</div>`.trim();
const widgetItem = widgetTemplate.content.firstChild;

const hideContainer = () => {
  console.log("*** in hideContainer");
  document.querySelector("#bw-container").classList.remove("show");
  document.querySelector("#bw-container").classList.add("hide");
};

const showContainer = () => {
  console.log("*** in showContainer");
  document.querySelector("#bw-container").classList.remove("hide");
  document.querySelector("#bw-container").classList.add("show");
};

const scrollHandlerToShowContainer = () => {
  console.log("*** in scroll handler to show container");
  if (window.scrollY > 800 && totalTimeSpent() > 1_000) {
    showContainer();
  } else {
    console.log("*** not showing because: ", window.scrollY, totalTimeSpent());
    hideContainer();
  }
};

const init = () => {
  document.querySelector("body").append(item);
  document.querySelector("body").append(widgetItem);

  document.addEventListener("scrollend", scrollHandlerToShowContainer);
  document.addEventListener("touchend", scrollHandlerToShowContainer);

  document
    .querySelector("#bw-container input.closePersonalize")
    .addEventListener("click", () => {
      document.removeEventListener("scrollend", scrollHandlerToShowContainer);
      document.removeEventListener("touchend", scrollHandlerToShowContainer);
      hideContainer();
    });

  document
    .querySelector("#bw-widget input.showOptions")
    .addEventListener("click", showContainer);

  document
    .querySelector("#bw-container input.personalize")
    .addEventListener("click", () => {
      hideContainer();
      document.removeEventListener("scrollend", scrollHandlerToShowContainer);
      document.removeEventListener("touchend", scrollHandlerToShowContainer);

      const widgetElem = document.querySelector("#bw-widget");

      document.documentElement.scroll({
        behavior: "smooth",
        top: widgetElem.offsetTop - 50,
      });

      const contentElem = document.querySelector(
        "#bw-widget > div.personalizedContent"
      );

      const howOften = document.querySelector(
        "#bw-container select[name='howOften']"
      ).value;
      const whichSmartDevice = document.querySelector(
        "#bw-container select[name='whichSmartDevice']"
      ).value;
      const primaryConcern = document.querySelector(
        "#bw-container select[name='primaryConcern']"
      ).value;

      let personalizedText = `Sorry unable to personalize for your provided input.`;

      personalizedResults.map((item) => {
        const { options } = item;
        console.log("options: ", options);
        console.log(howOften, whichSmartDevice, primaryConcern);
        if (
          options.howOften === howOften &&
          options.whichSmartDevice === whichSmartDevice &&
          options.primaryConcern === primaryConcern
        ) {
          personalizedText = item.text;
        }
      });

      const typewriter = new Typewriter(contentElem, {
        loop: false,
        delay: 0,
      });

      typewriter.typeString(personalizedText).start();
    });
};

if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", init);
} else {
  init();
}
